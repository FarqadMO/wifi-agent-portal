version: '3.8'

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: wifiagent-api
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET: ${JWT_SECRET}
      JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET}
      SAS_ENCRYPTION_KEY: ${SAS_ENCRYPTION_KEY}
      NODE_ENV: ${NODE_ENV}
      PORT: ${PORT}
      API_PREFIX: ${API_PREFIX}
      SWAGGER_ENABLED: ${SWAGGER_ENABLED}
      LOG_DIR: ${LOG_DIR}
      CORS_ORIGIN: ${CORS_ORIGIN}
      CORS_METHODS: ${CORS_METHODS}
      CORS_CREDENTIALS: ${CORS_CREDENTIALS}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN}
      JWT_REFRESH_EXPIRES_IN: ${JWT_REFRESH_EXPIRES_IN}
      SAS_REQUEST_TIMEOUT: ${SAS_REQUEST_TIMEOUT}
      SAS_MAX_RETRIES: ${SAS_MAX_RETRIES}
      SAS_RETRY_DELAY: ${SAS_RETRY_DELAY}
      APP_URL: ${APP_URL}
      FRONTEND_URL: ${FRONTEND_URL}
      PAYMENT_SUCCESS_URL: ${PAYMENT_SUCCESS_URL}
      PAYMENT_FAILURE_URL: ${PAYMENT_FAILURE_URL}
      PAYMENT_CANCEL_URL: ${PAYMENT_CANCEL_URL}
      QI_USERNAME_TEST: ${QI_USERNAME_TEST}
      QI_PASSWORD_TEST: ${QI_PASSWORD_TEST}
      QI_X_TERMINAL_ID_TEST: ${QI_X_TERMINAL_ID_TEST}
      QI_USERNAME_PROD: ${QI_USERNAME_PROD}
      QI_PASSWORD_PROD: ${QI_PASSWORD_PROD}
      QI_X_TERMINAL_ID_PROD: ${QI_X_TERMINAL_ID_PROD}
      QI_CURRENCY: ${QI_CURRENCY}
      QI_URL: ${QI_URL}
      QI_IS_PRODUCTION: ${QI_IS_PRODUCTION}
      QI_CALLBACK_TOKEN: ${QI_CALLBACK_TOKEN}
      QI_PUBLIC_KEY_PATH: ${QI_PUBLIC_KEY_PATH}
    volumes:
      - ./logs:/app/logs
    depends_on:
      - postgres

# Note: we don't define networks in compose; connect manually in Portainer UI

